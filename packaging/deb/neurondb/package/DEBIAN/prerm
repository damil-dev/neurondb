#!/bin/bash
set -e

# Pre-removal script for NeuronDB extension

echo "Checking if NeuronDB extension is in use..."

# Check if extension exists in any database
PG_VERSIONS=$(ls -1 /usr/lib/postgresql/ 2>/dev/null | grep -E '^[0-9]+$' || true)

if [ -z "$PG_VERSIONS" ]; then
    exit 0
fi

for PG_VERSION in $PG_VERSIONS; do
    if [ -f "/usr/lib/postgresql/$PG_VERSION/bin/psql" ]; then
        # Try to check if extension is installed (non-blocking)
        # This is informational only - we don't prevent removal
        echo "Note: If NeuronDB extension is installed in any database,"
        echo "      you may need to drop it manually before removing this package."
        break
    fi
done

exit 0

