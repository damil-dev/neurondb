openapi: 3.0.3
info:
  title: NeuronAgent API
  description: |
    REST API for NeuronAgent - AI agent runtime system providing agent state management,
    session handling, message processing, tool execution, and streaming capabilities.
  version: 1.0.0
  contact:
    name: NeuronDB Support
    email: support@neurondb.ai
  license:
    name: Proprietary
servers:
  - url: http://localhost:8080/api/v1
    description: Local development server
  - url: https://api.neurondb.ai/v1
    description: Production server

tags:
  - name: Agents
    description: Agent management operations
  - name: Sessions
    description: Session management operations
  - name: Messages
    description: Message handling operations
  - name: Tools
    description: Tool management operations
  - name: Memory
    description: Memory and context operations
  - name: Webhooks
    description: Webhook management
  - name: Evaluation
    description: Evaluation framework operations
  - name: Replay
    description: Execution snapshots and replay operations
  - name: Workflows
    description: Workflow management operations
  - name: Specializations
    description: Agent specialization management
  - name: Health
    description: Health check endpoints

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check if the service is healthy
      operationId: healthCheck
      security: []
    
    EvalTask:
      type: object
      properties:
        id:
          type: string
          format: uuid
        task_type:
          type: string
        input:
          type: string
        expected_output:
          type: string
          nullable: true
        expected_tool_sequence:
          type: object
        golden_sql_side_effects:
          type: object
        metadata:
          type: object
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateEvalTaskRequest:
      type: object
      required:
        - task_type
        - input
      properties:
        task_type:
          type: string
          enum: [tool_sequence, sql_side_effect, retrieval, end_to_end]
        input:
          type: string
        expected_output:
          type: string
        expected_tool_sequence:
          type: object
        golden_sql_side_effects:
          type: object
        metadata:
          type: object

    EvalRun:
      type: object
      properties:
        id:
          type: string
          format: uuid
        dataset_version:
          type: string
        agent_id:
          type: string
          format: uuid
          nullable: true
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
          nullable: true
        score:
          type: number
          nullable: true
        total_tasks:
          type: integer
        passed_tasks:
          type: integer
        failed_tasks:
          type: integer
        metadata:
          type: object
        created_at:
          type: string
          format: date-time

    CreateEvalRunRequest:
      type: object
      required:
        - dataset_version
      properties:
        dataset_version:
          type: string
        agent_id:
          type: string
          format: uuid
        total_tasks:
          type: integer
        metadata:
          type: object

    EvalTaskResult:
      type: object
      properties:
        id:
          type: string
          format: uuid
        eval_run_id:
          type: string
          format: uuid
        eval_task_id:
          type: string
          format: uuid
        session_id:
          type: string
          format: uuid
          nullable: true
        passed:
          type: boolean
        actual_output:
          type: string
          nullable: true
        actual_tool_sequence:
          type: object
        actual_sql_side_effects:
          type: object
        score:
          type: number
          nullable: true
        error_message:
          type: string
          nullable: true
        metadata:
          type: object
        created_at:
          type: string
          format: date-time

    Snapshot:
      type: object
      properties:
        id:
          type: string
          format: uuid
        session_id:
          type: string
          format: uuid
        agent_id:
          type: string
          format: uuid
        user_message:
          type: string
        execution_state:
          type: object
        deterministic_mode:
          type: boolean
        created_at:
          type: string
          format: date-time

    ReplayResponse:
      type: object
      properties:
        session_id:
          type: string
          format: uuid
        agent_id:
          type: string
          format: uuid
        user_message:
          type: string
        final_answer:
          type: string
        tool_calls:
          type: array
          items:
            type: object
        tool_results:
          type: array
          items:
            type: object
        tokens_used:
          type: integer

    WorkflowSchedule:
      type: object
      properties:
        id:
          type: string
          format: uuid
        workflow_id:
          type: string
          format: uuid
        cron_expression:
          type: string
        timezone:
          type: string
        enabled:
          type: boolean
        next_run_at:
          type: string
          format: date-time
          nullable: true
        last_run_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Specialization:
      type: object
      properties:
        id:
          type: string
          format: uuid
        agent_id:
          type: string
          format: uuid
        specialization_type:
          type: string
          enum: [planning, research, coding, execution, analysis, general]
        capabilities:
          type: array
          items:
            type: string
        config:
          type: object
        created_at:
          type: string
        updated_at:
          type: string

  responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok

  /agents:
    get:
      tags:
        - Agents
      summary: List agents
      description: List all agents, optionally filtered by search query
      operationId: listAgents
      parameters:
        - name: search
          in: query
          description: Search query to filter agents
          required: false
          schema:
            type: string
      responses:
        '200':
          description: List of agents
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Agent'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Agents
      summary: Create agent
      description: Create a new agent
      operationId: createAgent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAgentRequest'
      responses:
        '201':
          description: Agent created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Agent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agents/{id}:
    get:
      tags:
        - Agents
      summary: Get agent
      description: Get agent by ID
      operationId: getAgent
      parameters:
        - $ref: '#/components/parameters/AgentId'
      responses:
        '200':
          description: Agent details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Agent'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags:
        - Agents
      summary: Update agent
      description: Update an existing agent
      operationId: updateAgent
      parameters:
        - $ref: '#/components/parameters/AgentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAgentRequest'
      responses:
        '200':
          description: Agent updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Agent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - Agents
      summary: Delete agent
      description: Delete an agent by ID
      operationId: deleteAgent
      parameters:
        - $ref: '#/components/parameters/AgentId'
      responses:
        '204':
          description: Agent deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /sessions:
    post:
      tags:
        - Sessions
      summary: Create session
      description: Create a new session
      operationId: createSession
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSessionRequest'
      responses:
        '201':
          description: Session created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /sessions/{id}:
    get:
      tags:
        - Sessions
      summary: Get session
      description: Get session by ID
      operationId: getSession
      parameters:
        - $ref: '#/components/parameters/SessionId'
      responses:
        '200':
          description: Session details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags:
        - Sessions
      summary: Update session
      description: Update an existing session
      operationId: updateSession
      parameters:
        - $ref: '#/components/parameters/SessionId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSessionRequest'
      responses:
        '200':
          description: Session updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - Sessions
      summary: Delete session
      description: Delete a session by ID
      operationId: deleteSession
      parameters:
        - $ref: '#/components/parameters/SessionId'
      responses:
        '204':
          description: Session deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /sessions/{session_id}/messages:
    get:
      tags:
        - Messages
      summary: Get messages
      description: Get messages for a session
      operationId: getMessages
      parameters:
        - $ref: '#/components/parameters/SessionId'
        - name: limit
          in: query
          description: Maximum number of messages to return
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 100
        - name: offset
          in: query
          description: Number of messages to skip
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: List of messages
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Message'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Messages
      summary: Send message
      description: Send a message to a session
      operationId: sendMessage
      parameters:
        - $ref: '#/components/parameters/SessionId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendMessageRequest'
      responses:
        '200':
          description: Message processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /tools:
    get:
      tags:
        - Tools
      summary: List tools
      description: List all available tools
      operationId: listTools
      responses:
        '200':
          description: List of tools
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Tool'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Tools
      summary: Create tool
      description: Create a new tool
      operationId: createTool
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateToolRequest'
      responses:
        '201':
          description: Tool created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tool'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /tools/{name}:
    get:
      tags:
        - Tools
      summary: Get tool
      description: Get tool by name
      operationId: getTool
      parameters:
        - name: name
          in: path
          required: true
          description: Tool name
          schema:
            type: string
      responses:
        '200':
          description: Tool details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tool'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags:
        - Tools
      summary: Update tool
      description: Update an existing tool
      operationId: updateTool
      parameters:
        - name: name
          in: path
          required: true
          description: Tool name
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateToolRequest'
      responses:
        '200':
          description: Tool updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tool'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - Tools
      summary: Delete tool
      description: Delete a tool by name
      operationId: deleteTool
      parameters:
        - name: name
          in: path
          required: true
          description: Tool name
          schema:
            type: string
      responses:
        '204':
          description: Tool deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /eval/tasks:
    post:
      tags:
        - Evaluation
      summary: Create evaluation task
      operationId: createEvalTask
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEvalTaskRequest'
      responses:
        '201':
          description: Evaluation task created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvalTask'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      tags:
        - Evaluation
      summary: List evaluation tasks
      operationId: listEvalTasks
      parameters:
        - name: task_type
          in: query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
        - name: offset
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: List of evaluation tasks
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EvalTask'

  /eval/tasks/{id}:
    get:
      tags:
        - Evaluation
      summary: Get evaluation task
      operationId: getEvalTask
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Evaluation task
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvalTask'
        '404':
          $ref: '#/components/responses/NotFound'

  /eval/runs:
    post:
      tags:
        - Evaluation
      summary: Create evaluation run
      operationId: createEvalRun
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEvalRunRequest'
      responses:
        '201':
          description: Evaluation run created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvalRun'

    get:
      tags:
        - Evaluation
      summary: List evaluation runs
      operationId: listEvalRuns
      parameters:
        - name: dataset_version
          in: query
          schema:
            type: string
        - name: agent_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of evaluation runs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EvalRun'

  /eval/runs/{id}:
    get:
      tags:
        - Evaluation
      summary: Get evaluation run
      operationId: getEvalRun
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvalRun'

    put:
      tags:
        - Evaluation
      summary: Update evaluation run
      operationId: updateEvalRun
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                score:
                  type: number
                passed_tasks:
                  type: integer
                failed_tasks:
                  type: integer
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvalRun'

  /eval/runs/{run_id}/execute:
    post:
      tags:
        - Evaluation
      summary: Execute evaluation run
      operationId: executeEvalRun
      parameters:
        - name: run_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvalRun'

  /eval/runs/{run_id}/results:
    get:
      tags:
        - Evaluation
      summary: Get evaluation run results
      operationId: getEvalRunResults
      parameters:
        - name: run_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EvalTaskResult'

  /sessions/{session_id}/snapshots:
    post:
      tags:
        - Replay
      summary: Create execution snapshot
      operationId: createSnapshot
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_message:
                  type: string
                deterministic_mode:
                  type: boolean
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Snapshot'

    get:
      tags:
        - Replay
      summary: List snapshots for session
      operationId: listSnapshotsBySession
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Snapshot'

  /agents/{agent_id}/snapshots:
    get:
      tags:
        - Replay
      summary: List snapshots for agent
      operationId: listSnapshotsByAgent
      parameters:
        - name: agent_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Snapshot'

  /snapshots/{id}:
    get:
      tags:
        - Replay
      summary: Get snapshot
      operationId: getSnapshot
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Snapshot'

    delete:
      tags:
        - Replay
      summary: Delete snapshot
      operationId: deleteSnapshot
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Snapshot deleted

  /snapshots/{id}/replay:
    post:
      tags:
        - Replay
      summary: Replay execution from snapshot
      operationId: replaySnapshot
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReplayResponse'

  /workflows/{workflow_id}/schedule:
    post:
      tags:
        - Workflows
      summary: Create or update workflow schedule
      operationId: createWorkflowSchedule
      parameters:
        - name: workflow_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                cron_expression:
                  type: string
                timezone:
                  type: string
                enabled:
                  type: boolean
                next_run_at:
                  type: string
                  format: date-time
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowSchedule'

    get:
      tags:
        - Workflows
      summary: Get workflow schedule
      operationId: getWorkflowSchedule
      parameters:
        - name: workflow_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowSchedule'

    put:
      tags:
        - Workflows
      summary: Update workflow schedule
      operationId: updateWorkflowSchedule
      parameters:
        - name: workflow_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowSchedule'

    delete:
      tags:
        - Workflows
      summary: Delete workflow schedule
      operationId: deleteWorkflowSchedule
      parameters:
        - name: workflow_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Schedule deleted

  /workflow-schedules:
    get:
      tags:
        - Workflows
      summary: List workflow schedules
      operationId: listWorkflowSchedules
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WorkflowSchedule'

  /agents/{agent_id}/specialization:
    post:
      tags:
        - Specializations
      summary: Create agent specialization
      operationId: createSpecialization
      parameters:
        - name: agent_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                specialization_type:
                  type: string
                  enum: [planning, research, coding, execution, analysis, general]
                capabilities:
                  type: array
                  items:
                    type: string
                config:
                  type: object
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Specialization'

    get:
      tags:
        - Specializations
      summary: Get agent specialization
      operationId: getSpecialization
      parameters:
        - name: agent_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Specialization'

    put:
      tags:
        - Specializations
      summary: Update agent specialization
      operationId: updateSpecialization
      parameters:
        - name: agent_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Specialization'

    delete:
      tags:
        - Specializations
      summary: Delete agent specialization
      operationId: deleteSpecialization
      parameters:
        - name: agent_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Specialization deleted

  /specializations:
    get:
      tags:
        - Specializations
      summary: List specializations
      operationId: listSpecializations
      parameters:
        - name: specialization_type
          in: query
          schema:
            type: string
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Specialization'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: API Key
      description: API key authentication using Bearer token

  parameters:
    AgentId:
      name: id
      in: path
      required: true
      description: Agent UUID
      schema:
        type: string
        format: uuid

    SessionId:
      name: id
      in: path
      required: true
      description: Session UUID
      schema:
        type: string
        format: uuid

  schemas:
    Agent:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Agent UUID
        name:
          type: string
          description: Agent name
        description:
          type: string
          nullable: true
          description: Agent description
        system_prompt:
          type: string
          description: System prompt for the agent
        model_name:
          type: string
          description: LLM model name
        memory_table:
          type: string
          nullable: true
          description: Memory table name
        enabled_tools:
          type: array
          items:
            type: string
          description: List of enabled tool names
        config:
          type: object
          additionalProperties: true
          description: Agent configuration
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
        - id
        - name
        - system_prompt
        - model_name
        - enabled_tools
        - config
        - created_at
        - updated_at

    CreateAgentRequest:
      type: object
      properties:
        name:
          type: string
          description: Agent name
        description:
          type: string
          nullable: true
          description: Agent description
        system_prompt:
          type: string
          description: System prompt for the agent
        model_name:
          type: string
          description: LLM model name
        memory_table:
          type: string
          nullable: true
          description: Memory table name
        enabled_tools:
          type: array
          items:
            type: string
          description: List of enabled tool names
        config:
          type: object
          additionalProperties: true
          description: Agent configuration (temperature, max_tokens, etc.)
      required:
        - name
        - system_prompt
        - model_name
        - enabled_tools
        - config

    UpdateAgentRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
          nullable: true
        system_prompt:
          type: string
        model_name:
          type: string
        memory_table:
          type: string
          nullable: true
        enabled_tools:
          type: array
          items:
            type: string
        config:
          type: object
          additionalProperties: true

    Session:
      type: object
      properties:
        id:
          type: string
          format: uuid
        agent_id:
          type: string
          format: uuid
        external_user_id:
          type: string
          nullable: true
        metadata:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time
        last_activity_at:
          type: string
          format: date-time
      required:
        - id
        - agent_id
        - created_at
        - last_activity_at

    CreateSessionRequest:
      type: object
      properties:
        agent_id:
          type: string
          format: uuid
        external_user_id:
          type: string
          nullable: true
        metadata:
          type: object
          additionalProperties: true
      required:
        - agent_id

    UpdateSessionRequest:
      type: object
      properties:
        external_user_id:
          type: string
          nullable: true
        metadata:
          type: object
          additionalProperties: true

    Message:
      type: object
      properties:
        id:
          type: integer
          format: int64
        session_id:
          type: string
          format: uuid
        role:
          type: string
          enum: [user, assistant, system, tool]
        content:
          type: string
        tool_name:
          type: string
          nullable: true
        tool_call_id:
          type: string
          nullable: true
        token_count:
          type: integer
          nullable: true
        metadata:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time
      required:
        - id
        - session_id
        - role
        - content
        - created_at

    SendMessageRequest:
      type: object
      properties:
        role:
          type: string
          enum: [user, assistant, system]
          default: user
        content:
          type: string
        stream:
          type: boolean
          default: false
          description: Enable streaming response
        metadata:
          type: object
          additionalProperties: true
      required:
        - role
        - content

    MessageResponse:
      type: object
      properties:
        session_id:
          type: string
          format: uuid
        agent_id:
          type: string
          format: uuid
        response:
          type: string
        tokens_used:
          type: integer
        tool_calls:
          type: array
          items:
            type: object
        tool_results:
          type: array
          items:
            type: object
      required:
        - session_id
        - agent_id
        - response

    Tool:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        schema:
          type: object
          additionalProperties: true
          description: JSON schema for tool parameters
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
        - name
        - description
        - schema

    CreateToolRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        schema:
          type: object
          additionalProperties: true
        implementation:
          type: string
          description: Tool implementation code or configuration
      required:
        - name
        - description
        - schema

    UpdateToolRequest:
      type: object
      properties:
        description:
          type: string
        schema:
          type: object
          additionalProperties: true
        implementation:
          type: string

    Error:
      type: object
      properties:
        error:
          type: string
          description: Error type
        message:
          type: string
          description: Error message
        code:
          type: integer
          description: HTTP status code
      required:
        - error
        - code

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "Bad Request"
            message: "Invalid request parameters"
            code: 400

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "Not Found"
            message: "Resource not found"
            code: 404

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "Internal Server Error"
            message: "An internal error occurred"
            code: 500

security:
  - BearerAuth: []

