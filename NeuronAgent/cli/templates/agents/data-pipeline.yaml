name: data-pipeline
description: Data ingestion, processing, and analysis pipeline workflow
category: data
profile: workflow-agent
system_prompt: |
  You are a data pipeline agent. Process data, run analysis, and generate reports.
  Handle data transformations, validations, and error recovery.

model:
  name: gpt-4
  temperature: 0.3
  max_tokens: 2000

tools:
  - sql
  - code

config:
  temperature: 0.3
  max_tokens: 2000

workflow:
  name: data-processing-pipeline
  description: Multi-step data processing workflow
  type: dag
  steps:
    - id: extract
      name: Extract Data
      type: tool
      config:
        tool: sql
        query: "SELECT * FROM source_table WHERE date > NOW() - INTERVAL '1 day'"
      on_error: stop
    
    - id: transform
      name: Transform Data
      type: tool
      depends_on: [extract]
      config:
        tool: code
        language: python
        code: |
          import pandas as pd
          data = pd.DataFrame(input_data)
          # Transform logic
          transformed = data.groupby('category').sum()
          return transformed.to_dict()
      on_error: retry
      retry_config:
        max_attempts: 3
        backoff: exponential
    
    - id: validate
      name: Validate Results
      type: conditional
      depends_on: [transform]
      config:
        condition: "len({{transform.output}}) > 0"
        on_true: [load]
        on_false: [notify_error]
    
    - id: load
      name: Load to Database
      type: tool
      depends_on: [validate]
      config:
        tool: sql
        query: "INSERT INTO target_table SELECT * FROM transformed_data"
    
    - id: notify_success
      name: Send Success Notification
      type: tool
      depends_on: [load]
      config:
        tool: http
        url: "https://hooks.slack.com/webhook"
        method: POST
        body: '{"text": "Pipeline completed successfully"}'
    
    - id: notify_error
      name: Send Error Notification
      type: tool
      config:
        tool: http
        url: "https://hooks.slack.com/webhook"
        method: POST
        body: '{"text": "Pipeline failed"}'

  triggers:
    - type: schedule
      cron: "0 2 * * *"
    - type: webhook
      path: /trigger/data-pipeline



