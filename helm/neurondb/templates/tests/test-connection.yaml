apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "neurondb.fullname" . }}-test-connection"
  labels:
    {{- include "neurondb.labels" . | nindent 4 }}
    app.kubernetes.io/component: test
  annotations:
    "helm.sh/hook": test
spec:
  containers:
  - name: test-connection
    image: busybox:1.36
    command: ['sh', '-c']
    args:
      - |
        echo "Testing NeuronDB connection..."
        nc -z {{ include "neurondb.neurondb.serviceName" . }} {{ .Values.neurondb.postgresql.port }} && echo "✓ NeuronDB is reachable" || exit 1
        
        echo "Testing NeuronAgent..."
        nc -z {{ include "neurondb.neuronagent.serviceName" . }} {{ .Values.neuronagent.service.port }} && echo "✓ NeuronAgent is reachable" || exit 1
        
        echo "Testing NeuronDesktop API..."
        nc -z {{ include "neurondb.neurondesktop-api.serviceName" . }} {{ .Values.neurondesktop.api.service.port }} && echo "✓ NeuronDesktop API is reachable" || exit 1
        
        echo "All services are reachable!"
  restartPolicy: Never

